<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ƒêi·ªÉm danh ‚Äî QLTT L·ªõp h·ªçc</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="app" role="application">
    <aside class="sidebar" aria-label="Thanh ƒëi·ªÅu h∆∞·ªõng">
      <div class="brand">
        <div class="logo">QL</div>
        <div>
          <div class="title">QLTT L·ªõp h·ªçc</div>
          <div style="font-size:12px;color:var(--muted)">Qu·∫£n l√Ω th√¥ng tin l·ªõp & sinh vi√™n</div>
        </div>
      </div>

      <div class="profile-mini" id="sidebar-profile">
        <div id="side-avatar" style="width:44px;height:44px;border-radius:8px;background:#f3f4f6;overflow:hidden;display:flex;align-items:center;justify-content:center;border:1px solid rgba(0,0,0,0.04)">
          <img id="side-avatar-img" src="" alt="avatar" style="width:100%;height:100%;object-fit:cover;display:none">
          <div id="side-avatar-placeholder" style="font-weight:700;color:var(--muted)">U</div>
        </div>
        <div class="info">
          <div id="side-name" style="font-weight:700">Kh√°ch</div>
          <div id="side-role" style="font-size:12px;color:var(--muted)">Kh√¥ng c√≥ phi√™n</div>
        </div>
      </div>

      <nav class="side-nav" aria-label="Ch·ª©c nƒÉng">
        <button id="nav-dash">T·ªïng quan</button>
        <button id="nav-classes">L·ªõp h·ªçc</button>
        <button id="nav-schedule">L·ªãch</button>
        <button id="nav-grades">ƒêi·ªÉm s·ªë</button>
        <button id="nav-attendance" class="active">ƒêi·ªÉm danh</button>
        <button id="nav-students">Sinh vi√™n</button>
        <button id="nav-settings">C√†i ƒë·∫∑t</button>
      </nav>

      <div style="margin-top:auto; display:flex; gap:8px; align-items:center; justify-content:center">
        <button id="nav-profile" style="padding:8px 12px;border-radius:10px;border:1px solid rgba(16,24,40,0.06);background:transparent;cursor:pointer">H·ªì s∆°</button>
        <button id="nav-logout" style="padding:8px 12px;border-radius:10px;background:var(--accent);color:#fff;border:none;cursor:pointer">ƒêƒÉng xu·∫•t</button>
      </div>
    </aside>

    <section class="main" aria-live="polite">
      <div class="topbar">
        <div style="display:flex; gap:12px; align-items:center;">
          <button id="backToHome" style="background: transparent; border: 1px solid rgba(16,24,40,0.06); padding: 8px 12px; border-radius: 8px; cursor: pointer; color: var(--muted); font-size: 14px; display: flex; align-items: center; gap: 6px;" title="Quay v·ªÅ trang ch·ªß">
            ‚Üê Quay v·ªÅ
          </button>
          <h2 style="margin:0">ƒêi·ªÉm danh</h2>
          <div style="font-size:13px;color:var(--muted)">Theo d√µi t√¨nh tr·∫°ng chuy√™n c·∫ßn</div>
        </div>

        <div class="search">
          <input id="global-search" placeholder="T√¨m m√¥n h·ªçc, ng√†y..." />
          <div class="top-actions">
            <button class="icon-btn" id="notifBtn" title="Th√¥ng b√°o">üîî</button>
            <button class="icon-btn" id="quickAdd">Ôºã</button>
            <div style="display:flex; align-items:center; gap:8px;">
              <div id="nav-avatar" style="width:40px;height:40px;border-radius:10px;overflow:hidden;border:1px solid rgba(0,0,0,0.04);display:flex;align-items:center;justify-content:center">
                <img id="nav-avatar-img" src="" alt="Avatar" style="width:100%;height:100%;object-fit:cover;display:none">
                <div id="nav-avatar-placeholder" style="font-weight:700;color:var(--muted)">U</div>
              </div>
              <div style="display:flex; flex-direction:column; align-items:flex-start;">
                <div id="nav-user" style="font-weight:700">Kh√°ch</div>
                <div style="font-size:12px;color:var(--muted)" id="nav-role">‚Äî</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="attendance-container">
        <!-- Overview Stats -->
        <div class="attendance-overview">
          <div class="card">
            <h3 style="margin:0 0 16px 0">T·ªïng quan chuy√™n c·∫ßn</h3>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="overallAttendance">92.5%</div>
                <div class="stat-label">T·ª∑ l·ªá chuy√™n c·∫ßn</div>
                <div class="stat-trend positive">+2.1% so v·ªõi k·ª≥ tr∆∞·ªõc</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="totalClasses">48</div>
                <div class="stat-label">T·ªïng s·ªë bu·ªïi</div>
                <div class="stat-trend neutral">6 m√¥n h·ªçc</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="attendedClasses">44</div>
                <div class="stat-label">Bu·ªïi c√≥ m·∫∑t</div>
                <div class="stat-trend positive">91.7%</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="absentClasses">4</div>
                <div class="stat-label">Bu·ªïi v·∫Øng m·∫∑t</div>
                <div class="stat-trend negative">8.3%</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Attendance Chart -->
        <div class="attendance-chart-section">
          <div class="card">
            <h3 style="margin:0 0 16px 0">Bi·ªÉu ƒë·ªì chuy√™n c·∫ßn theo th·ªùi gian</h3>
            <div style="height: 300px; position: relative;">
              <canvas id="attendanceChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Subject Attendance -->
        <div class="subject-attendance-section">
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
              <h3 style="margin:0">ƒêi·ªÉm danh chi ti·∫øt t·ª´ng m√¥n</h3>
              <div style="display:flex;gap:8px">
                <select id="subjectFilter" style="padding:6px 10px;border-radius:6px;border:1px solid rgba(16,24,40,0.06);">
                  <option value="all">T·∫•t c·∫£ m√¥n</option>
                  <option value="MATH101">To√°n 101</option>
                  <option value="PHYS201">V·∫≠t l√Ω 201</option>
                  <option value="CHEM301">H√≥a h·ªçc 301</option>
                  <option value="CS401">Tin h·ªçc 401</option>
                  <option value="ENG501">Anh vƒÉn 501</option>
                  <option value="HIST601">L·ªãch s·ª≠ 601</option>
                </select>
                <select id="monthFilter" style="padding:6px 10px;border-radius:6px;border:1px solid rgba(16,24,40,0.06);">
                  <option value="all">T·∫•t c·∫£ th√°ng</option>
                  <option value="2024-10">Th√°ng 10/2024</option>
                  <option value="2024-11">Th√°ng 11/2024</option>
                  <option value="2024-12">Th√°ng 12/2024</option>
                </select>
                <button class="icon-btn" id="exportAttendance">Xu·∫•t Excel</button>
              </div>
            </div>
            <div id="subjectAttendanceList">
              <!-- Subject attendance will be generated by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Attendance Calendar -->
        <div class="attendance-calendar-section">
          <div class="card">
            <h3 style="margin:0 0 16px 0">L·ªãch ƒëi·ªÉm danh th√°ng n√†y</h3>
            <div class="attendance-calendar" id="attendanceCalendar">
              <!-- Calendar will be generated by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <footer>
        &copy; 2025 QLTT L·ªõp h·ªçc ‚Äî H·ªá th·ªëng qu·∫£n l√Ω th√¥ng tin l·ªõp h·ªçc
      </footer>
    </section>
  </div>

  <script src="assets/js/main.js"></script>
  <script src="assets/js/attendance.js"></script>
  <script>
    // Profile and navigation logic
    (function(){
      const navUser = document.getElementById('nav-user');
      const navAvatarImg = document.getElementById('nav-avatar-img');
      const navAvatarPlaceholder = document.getElementById('nav-avatar-placeholder');
      const profileBtn = document.getElementById('nav-profile');
      const logoutBtn = document.getElementById('nav-logout');

      function getSessionEmail(){ return (localStorage.getItem('sessionEmail') || '').toLowerCase(); }
      function loadProfile(email){
        if(!email) return null;
        try{ const raw = localStorage.getItem('profile::' + email.toLowerCase()); if(raw) return JSON.parse(raw); }catch(e){}
        return { name: email.split('@')[0] || '', email: email, phone: '', address: '', role: 'student', avatar: null };
      }

      function initNav(){
        const email = getSessionEmail();
        if(email){
          const profile = loadProfile(email);
          navUser.textContent = (profile && profile.name) ? profile.name : email;
          if(profile && profile.avatar){
            navAvatarImg.src = profile.avatar;
            navAvatarImg.style.display = 'block';
            navAvatarPlaceholder.style.display = 'none';
          } else {
            navAvatarImg.src = '';
            navAvatarImg.style.display = 'none';
            navAvatarPlaceholder.textContent = (profile && profile.name && profile.name[0]) ? profile.name[0].toUpperCase() : 'U';
            navAvatarPlaceholder.style.display = 'flex';
          }
          // sidebar mini
          try {
            document.getElementById('side-name').textContent = (profile && profile.name) ? profile.name : email;
            document.getElementById('side-role').textContent = (profile && profile.role) ? profile.role : '‚Äî';
            const sideImg = document.getElementById('side-avatar-img');
            const sidePl = document.getElementById('side-avatar-placeholder');
            if(profile && profile.avatar){
              sideImg.src = profile.avatar; sideImg.style.display = 'block'; sidePl.style.display = 'none';
            } else { sideImg.style.display = 'none'; sidePl.textContent = (profile && profile.name && profile.name[0]) ? profile.name[0].toUpperCase() : 'U'; sidePl.style.display = 'flex'; }
          } catch(e){}
        } else {
          navUser.textContent = 'Kh√°ch';
          navAvatarImg.src = '';
          navAvatarImg.style.display = 'none';
          navAvatarPlaceholder.textContent = 'U';
          navAvatarPlaceholder.style.display = 'flex';
        }
      }

      // Navigation
      document.getElementById('nav-dash').addEventListener('click', () => window.location.href = 'index.html');
      document.getElementById('nav-classes').addEventListener('click', () => window.location.href = 'index.html');
      document.getElementById('nav-schedule').addEventListener('click', () => window.location.href = 'schedule.html');
      document.getElementById('nav-grades').addEventListener('click', () => window.location.href = 'grades.html');
      document.getElementById('nav-students').addEventListener('click', () => window.location.href = 'index.html');
      document.getElementById('nav-settings').addEventListener('click', () => window.location.href = 'index.html');
      
      // Back to home button
      document.getElementById('backToHome').addEventListener('click', () => {
        window.location.href = 'index.html';
      });
      
      logoutBtn.addEventListener('click', ()=>{
        try{ localStorage.removeItem('sessionEmail'); }catch(e){}
        window.location.href = './login.html';
      });

      initNav();
    })();
  </script>
</body>
</html>
