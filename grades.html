<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ƒêi·ªÉm s·ªë ‚Äî QLTT L·ªõp h·ªçc</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="app" role="application">
    <aside class="sidebar" aria-label="Thanh ƒëi·ªÅu h∆∞·ªõng">
      <div class="brand">
        <div class="logo">QL</div>
        <div>
          <div class="title">QLTT L·ªõp h·ªçc</div>
          <div style="font-size:12px;color:var(--muted)">Qu·∫£n l√Ω th√¥ng tin l·ªõp & sinh vi√™n</div>
        </div>
      </div>

      <div class="profile-mini" id="sidebar-profile">
        <div id="side-avatar" style="width:44px;height:44px;border-radius:8px;background:#f3f4f6;overflow:hidden;display:flex;align-items:center;justify-content:center;border:1px solid rgba(0,0,0,0.04)">
          <img id="side-avatar-img" src="" alt="avatar" style="width:100%;height:100%;object-fit:cover;display:none">
          <div id="side-avatar-placeholder" style="font-weight:700;color:var(--muted)">U</div>
        </div>
        <div class="info">
          <div id="side-name" style="font-weight:700">Kh√°ch</div>
          <div id="side-role" style="font-size:12px;color:var(--muted)">Kh√¥ng c√≥ phi√™n</div>
        </div>
      </div>

      <nav class="side-nav" aria-label="Ch·ª©c nƒÉng">
        <button id="nav-dash">T·ªïng quan</button>
        <button id="nav-classes">L·ªõp h·ªçc</button>
        <button id="nav-schedule">L·ªãch</button>
        <button id="nav-grades" class="active">ƒêi·ªÉm s·ªë</button>
        <button id="nav-attendance">ƒêi·ªÉm danh</button>
        <button id="nav-students">Sinh vi√™n</button>
        <button id="nav-settings">C√†i ƒë·∫∑t</button>
      </nav>

      <div style="margin-top:auto; display:flex; gap:8px; align-items:center; justify-content:center">
        <button id="nav-profile" style="padding:8px 12px;border-radius:10px;border:1px solid rgba(16,24,40,0.06);background:transparent;cursor:pointer">H·ªì s∆°</button>
        <button id="nav-logout" style="padding:8px 12px;border-radius:10px;background:var(--accent);color:#fff;border:none;cursor:pointer">ƒêƒÉng xu·∫•t</button>
      </div>
    </aside>

    <section class="main" aria-live="polite">
      <div class="topbar">
        <div style="display:flex; gap:12px; align-items:center;">
          <button id="backToHome" style="background: transparent; border: 1px solid rgba(16,24,40,0.06); padding: 8px 12px; border-radius: 8px; cursor: pointer; color: var(--muted); font-size: 14px; display: flex; align-items: center; gap: 6px;" title="Quay v·ªÅ trang ch·ªß">
            ‚Üê Quay v·ªÅ
          </button>
          <h2 style="margin:0">ƒêi·ªÉm s·ªë</h2>
          <div style="font-size:13px;color:var(--muted)">Theo d√µi k·∫øt qu·∫£ h·ªçc t·∫≠p</div>
        </div>

        <div class="search">
          <input id="global-search" placeholder="T√¨m m√¥n h·ªçc, ƒëi·ªÉm s·ªë..." />
          <div class="top-actions">
            <button class="icon-btn" id="notifBtn" title="Th√¥ng b√°o">üîî</button>
            <button class="icon-btn" id="quickAdd">Ôºã</button>
            <div style="display:flex; align-items:center; gap:8px;">
              <div id="nav-avatar" style="width:40px;height:40px;border-radius:10px;overflow:hidden;border:1px solid rgba(0,0,0,0.04);display:flex;align-items:center;justify-content:center">
                <img id="nav-avatar-img" src="" alt="Avatar" style="width:100%;height:100%;object-fit:cover;display:none">
                <div id="nav-avatar-placeholder" style="font-weight:700;color:var(--muted)">U</div>
              </div>
              <div style="display:flex; flex-direction:column; align-items:flex-start;">
                <div id="nav-user" style="font-weight:700">Kh√°ch</div>
                <div style="font-size:12px;color:var(--muted)" id="nav-role">‚Äî</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="grades-container">
        <!-- Overview Stats -->
        <div class="grades-overview">
          <div class="card">
            <h3 style="margin:0 0 16px 0">T·ªïng quan ƒëi·ªÉm s·ªë</h3>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="overallGPA">3.2</div>
                <div class="stat-label">ƒêi·ªÉm TB chung</div>
                <div class="stat-trend positive">+0.3 so v·ªõi k·ª≥ tr∆∞·ªõc</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="totalCredits">24</div>
                <div class="stat-label">T√≠n ch·ªâ ƒë√£ h·ªçc</div>
                <div class="stat-trend neutral">6 m√¥n h·ªçc</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="passedSubjects">5</div>
                <div class="stat-label">M√¥n ƒë√£ qua</div>
                <div class="stat-trend positive">83% t·ª∑ l·ªá ƒë·∫≠u</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="excellentGrades">2</div>
                <div class="stat-label">M√¥n xu·∫•t s·∫Øc</div>
                <div class="stat-trend positive">A+ v√† A</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Grades Chart -->
        <div class="grades-chart-section">
          <div class="card">
            <h3 style="margin:0 0 16px 0">Bi·ªÉu ƒë·ªì ƒëi·ªÉm s·ªë theo th·ªùi gian</h3>
            <div style="height: 300px; position: relative;">
              <canvas id="gradesChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Subject Grades -->
        <div class="subject-grades-section">
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
              <h3 style="margin:0">ƒêi·ªÉm chi ti·∫øt t·ª´ng m√¥n</h3>
              <div style="display:flex;gap:8px">
                <select id="semesterFilter" style="padding:6px 10px;border-radius:6px;border:1px solid rgba(16,24,40,0.06);">
                  <option value="all">T·∫•t c·∫£ k·ª≥</option>
                  <option value="2024-2">H·ªçc k·ª≥ 2 - 2024</option>
                  <option value="2024-1">H·ªçc k·ª≥ 1 - 2024</option>
                </select>
                <button class="icon-btn" id="exportGrades">Xu·∫•t Excel</button>
              </div>
            </div>
            <div id="subjectGradesList">
              <!-- Subject grades will be generated by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Grade Distribution -->
        <div class="grade-distribution-section">
          <div class="card">
            <h3 style="margin:0 0 16px 0">Ph√¢n b·ªë ƒëi·ªÉm s·ªë</h3>
            <div style="height: 250px; position: relative;">
              <canvas id="gradeDistributionChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <footer>
        &copy; 2025 QLTT L·ªõp h·ªçc ‚Äî H·ªá th·ªëng qu·∫£n l√Ω th√¥ng tin l·ªõp h·ªçc
      </footer>
    </section>
  </div>

  <script src="assets/js/main.js"></script>
  <script src="assets/js/grades.js"></script>
  <script>
    // Profile and navigation logic
    (function(){
      const navUser = document.getElementById('nav-user');
      const navAvatarImg = document.getElementById('nav-avatar-img');
      const navAvatarPlaceholder = document.getElementById('nav-avatar-placeholder');
      const profileBtn = document.getElementById('nav-profile');
      const logoutBtn = document.getElementById('nav-logout');

      function getSessionEmail(){ return (localStorage.getItem('sessionEmail') || '').toLowerCase(); }
      function loadProfile(email){
        if(!email) return null;
        try{ const raw = localStorage.getItem('profile::' + email.toLowerCase()); if(raw) return JSON.parse(raw); }catch(e){}
        return { name: email.split('@')[0] || '', email: email, phone: '', address: '', role: 'student', avatar: null };
      }

      function initNav(){
        const email = getSessionEmail();
        if(email){
          const profile = loadProfile(email);
          navUser.textContent = (profile && profile.name) ? profile.name : email;
          if(profile && profile.avatar){
            navAvatarImg.src = profile.avatar;
            navAvatarImg.style.display = 'block';
            navAvatarPlaceholder.style.display = 'none';
          } else {
            navAvatarImg.src = '';
            navAvatarImg.style.display = 'none';
            navAvatarPlaceholder.textContent = (profile && profile.name && profile.name[0]) ? profile.name[0].toUpperCase() : 'U';
            navAvatarPlaceholder.style.display = 'flex';
          }
          // sidebar mini
          try {
            document.getElementById('side-name').textContent = (profile && profile.name) ? profile.name : email;
            document.getElementById('side-role').textContent = (profile && profile.role) ? profile.role : '‚Äî';
            const sideImg = document.getElementById('side-avatar-img');
            const sidePl = document.getElementById('side-avatar-placeholder');
            if(profile && profile.avatar){
              sideImg.src = profile.avatar; sideImg.style.display = 'block'; sidePl.style.display = 'none';
            } else { sideImg.style.display = 'none'; sidePl.textContent = (profile && profile.name && profile.name[0]) ? profile.name[0].toUpperCase() : 'U'; sidePl.style.display = 'flex'; }
          } catch(e){}
        } else {
          navUser.textContent = 'Kh√°ch';
          navAvatarImg.src = '';
          navAvatarImg.style.display = 'none';
          navAvatarPlaceholder.textContent = 'U';
          navAvatarPlaceholder.style.display = 'flex';
        }
      }

      // Navigation
      document.getElementById('nav-dash').addEventListener('click', () => window.location.href = 'index.html');
      document.getElementById('nav-classes').addEventListener('click', () => window.location.href = 'index.html');
      document.getElementById('nav-schedule').addEventListener('click', () => window.location.href = 'schedule.html');
      document.getElementById('nav-attendance').addEventListener('click', () => window.location.href = 'attendance.html');
      document.getElementById('nav-students').addEventListener('click', () => window.location.href = 'index.html');
      document.getElementById('nav-settings').addEventListener('click', () => window.location.href = 'index.html');
      
      // Back to home button
      document.getElementById('backToHome').addEventListener('click', () => {
        window.location.href = 'index.html';
      });
      
      logoutBtn.addEventListener('click', ()=>{
        try{ localStorage.removeItem('sessionEmail'); }catch(e){}
        window.location.href = './login.html';
      });

      initNav();
    })();
  </script>
</body>
</html>
